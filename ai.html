<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Analysis Interface</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2d3748;
            margin-bottom: 1.5rem;
        }

        .input-section {
            margin-bottom: 1.5rem;
        }
        .disclaimer-box {
    background-color: #f8f9fa;
    border-left: 4px solid #dc3545;
    padding: 1rem;
    margin-bottom: 1.5rem;
    border-radius: 4px;
}

        .disclaimer-box h3 {
    color: #dc3545;
    margin-top: 0;
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

        .disclaimer-box p {
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.5;
    color: #343a40;
}

        textarea {
            width: 100%;
            min-height: 100px;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            resize: vertical;
        }

        button {
            background-color: #4299e1;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #3182ce;
        }

        button:disabled {
            background-color: #a0aec0;
            cursor: not-allowed;
        }

        .output-section {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #f7fafc;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
        }

        .output-section pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .status {
            margin-top: 1rem;
            padding: 0.5rem;
            border-radius: 4px;
        }

        .status.error {
            background-color: #fed7d7;
            color: #c53030;
        }

        .status.success {
            background-color: #c6f6d5;
            color: #2f855a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Stock Analysis Interface</h1>
        
        <div class="input-section">
            <h2>Input</h2>
            <textarea id="input" placeholder="Enter stock ticker (e.g., AAPL, MSFT, NVDA) "></textarea>
            <button id="submit">Analyze Stock</button>
        </div>

        <div class="output-section">
            <h2>Output</h2>
            <pre id="output">Stock analysis will appear here...</pre>
        </div>

        <div id="status" class="status"></div>
    </div>

    <script>
        // Make sure the DOM is fully loaded before running our code
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Script starting...');

            const submitButton = document.getElementById('submit');
            const inputArea = document.getElementById('input');
            const outputArea = document.getElementById('output');
            const statusArea = document.getElementById('status');

            console.log('Elements found:', {
                submitButton: !!submitButton,
                inputArea: !!inputArea,
                outputArea: !!outputArea,
                statusArea: !!statusArea
            });

            if (submitButton) {
                submitButton.addEventListener('click', async () => {
                    console.log('Button clicked');
                    const ticker = inputArea.value.trim();
                    
                    if (!ticker) {
                        statusArea.textContent = 'Please enter a stock ticker';
                        statusArea.className = 'status error';
                        return;
                    }

                    try {
                        submitButton.disabled = true;
                        outputArea.textContent = 'Analyzing stock data...(Disclaimer: This content is generated by automated systems and may contain errors. It is for educational purposes only and does not constitute financial advice. I am not liable for any actions taken based on this information.)';
                        statusArea.textContent = '';

                        console.log('Sending request for ticker:', ticker);
                        const response = await fetch('/process', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ input: ticker }),
                        });

                        console.log('Response status:', response.status);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const data = await response.json();
                        console.log('Received data:', data);

                        // Format the output
                        let formattedOutput = '';
                        
                        if (data.news_items && data.news_items.length > 0) {
                            formattedOutput += '=== NEWS ANALYSIS ===\n\n';
                            data.news_items.forEach((item, index) => {
                                formattedOutput += `${index + 1}. ${item.title}\n`;
                                formattedOutput += `   Published: ${item.published_date}\n`;
                                formattedOutput += `   Source: ${item.source}\n`;
                                formattedOutput += `   Sentiment: ${item.sentiment}\n`;
                                formattedOutput += `   Summary: ${item.summary}\n\n`;
                            });
                        }

                        if (data.ai_analysis) {
                            formattedOutput += '\n=== AI ANALYSIS ===\n\n';
                            formattedOutput += data.ai_analysis;
                        }

                        outputArea.textContent = formattedOutput;
                        statusArea.textContent = 'Analysis completed successfully';
                        statusArea.className = 'status success';
                        
                    } catch (error) {
                        console.error('Error:', error);
                        outputArea.textContent = 'An error occurred while analyzing the stock';
                        statusArea.textContent = `Error: ${error.message}`;
                        statusArea.className = 'status error';
                    } finally {
                        submitButton.disabled = false;
                    }
                });
            } else {
                console.error('Could not find submit button!');
            }
        });
    </script>
</body>
</html>